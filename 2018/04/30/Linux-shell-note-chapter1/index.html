<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Linux-shell-note-chapter1 | Zexing Jiang&#39;s Blog</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="Keep passion. Keep sensitive.">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Linux-shell-note-chapter1 | Zexing Jiang&#39;s Blog">
    <meta name="twitter:description" content="Keep passion. Keep sensitive.">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Linux-shell-note-chapter1 | Zexing Jiang&#39;s Blog">
    <meta property="og:description" content="Keep passion. Keep sensitive.">

    
    <meta name="author" content="Zexing Jiang">
    

    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/zx-logo.png">
    

    <meta name="generator" content="hexo"/>
    

    <link rel="canonical" href="http://yoursite.com/2018/04/30/Linux-shell-note-chapter1/"/>

    

</head>

<body class="home-template no-js">

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="Go to the home of Zexing Jiang&#39;s Blog "><img src="/images/front-logo.jpg" width="80" alt="Zexing Jiang&#39;s Blog logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Zexing Jiang&#39;s Blog">Zexing Jiang&#39;s Blog</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">Keep passion. Keep sensitive.</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description"></p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="blog" class="blog-button">Blog</a></li>
            
              <li class="navigation__item"><a href="/archives">Archives</a></li>
            
              <li class="navigation__item"><a href="/books">Books</a></li>
            
              <li class="navigation__item"><a href="/aboutme">About me</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/eligah" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


  <!-- Douban -->
  
  <li class="navigation__item">
    <a href="https://www.douban.com/people/148411769/" title="查看我的Douban主页" target="_blank">
      <i class='social fa fa-leaf'></i>
      <span class="label">Douban</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  <li class="navigation__item">
    <a href="https://www.facebook.com/profile.php?id=100015381183992" title="上Facebook找我" target="_blank">
      <i class='social fa fa-facebook'></i>
      <span class="label">Facebook</span>
    </a>
  </li>


<!-- Linkedin -->

  <li class="navigation__item">
    <a href="https://www.linkedin.com/in/%E6%B3%BD%E6%98%9F-%E6%B1%9F-141301136/" title="Find me in Linkedin" target="_blank">
      <i class='social fa fa-linkedin'></i>
      <span class="label">Linkedin</span>
    </a>
  </li>

  
<!-- Twitter -->

  




  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-slate"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-04-30T13:42:51.000Z" class="post-list__meta--date date">2018-04-30</time> &#8226; <span class="post-meta__tags tags">at&nbsp;
  <a class="tag-link" href="/tags/linux/">linux</a>, <a class="tag-link" href="/tags/shell/">shell</a>
</span>
    </div>
    <h1 class="post-title">Linux-shell-note-chapter1</h1>
  </header>

  <section class="post">
    <h1><span id="overview">Overview</span></h1><p>本章内容从认识shell开始, 介绍了shell对于命令的处理, 以及最基本的逻辑结构的书写方式.<br><a id="more"></a></p>
<div class="toc">

<!-- toc -->
<ul>
<li><a href="#zai-zhong-duan-zhong-xian-shi-shu-chu">在终端中显示输出</a></li>
<li><a href="#ming-ling-jie-xi">命令解析</a></li>
<li><a href="#shi-yong-bian-liang-yu-huan-jing-bian-liang">使用变量与环境变量</a></li>
<li><a href="#shi-yong-han-shu-tian-jia-huan-jing-bian-liang">使用函数添加环境变量</a></li>
<li><a href="#shell-jin-xing-shu-xue-yun-suan">shell进行数学运算</a></li>
<li><a href="#chong-ding-xiang">重定向</a></li>
<li><a href="#shu-zu-yu-guan-lian-shu-zu">数组与关联数组</a></li>
<li><a href="#bie-ming">别名</a></li>
<li><a href="#cai-ji-zhong-duan-xin-xi">采集终端信息</a></li>
<li><a href="#huo-qu-bing-she-zhi-ri-qi-ji-yan-shi">获取并设置日期及延时</a></li>
<li><a href="#diao-shi-jiao-ben">调试脚本</a></li>
<li><a href="#han-shu-he-can-shu">函数和参数</a></li>
<li><a href="#di-gui-zha-dan">递归炸弹</a></li>
<li><a href="#bao-cun-tui-chu-zhuang-tai">保存退出状态</a></li>
<li><a href="#ming-ling-de-xuan-xiang">命令的选项</a></li>
<li><a href="#zai-bu-an-xia-hui-che-jian-de-qing-kuang-xia-du-ru-n-ge-zi-fu">在不按下回车键的情况下读入n个字符</a></li>
<li><a href="#chi-xu-yun-xing-ming-ling-zhi-zhi-zhi-xing-cheng-gong">持续运行命令直至执行成功</a></li>
<li><a href="#zi-duan-fen-ge-fu-yu-die-dai-qi">字段分隔符与迭代器</a></li>
<li><a href="#loops">loops</a><ul>
<li><a href="#mian-xiang-lie-biao-de-for-xun-huan">面向列表的for循环</a></li>
<li><a href="#die-dai-fan-wei-shu-zi">迭代范围数字</a></li>
<li><a href="#while-loop">while loop</a></li>
<li><a href="#until">until</a></li>
<li><a href="#compare">compare</a></li>
<li><a href="#jian-hua-ban-if-else">简化版if、else.</a></li>
<li><a href="#duo-ge-pan-duan-tiao-jian">多个判断条件</a></li>
<li><a href="#zi-fu-chuan-bi-jiao">字符串比较</a></li>
<li><a href="#ce-shi-kong-chuan">测试空串</a></li>
</ul>
</li>
<li><a href="#jiao-hu-shell-fei-jiao-hu-shell-deng-lu-shell-fei-deng-lu-shell">交互shell，非交互shell，登陆shell，非登陆shell</a></li>
</ul>
<!-- tocstop -->
<p></div></p>
<h2><span id="zai-zhong-duan-zhong-xian-shi-shu-chu">在终端中显示输出</span></h2><ul>
<li>shell脚本通常以shebang起始,即<code>#!/bin/bash</code>, shebang表示应该使用解释器路径.</li>
<li>脚本的执行方式<ol>
<li>脚本名作为命令行参数 <code>source ./myScript.sh</code>, 不会执行子进程.</li>
<li>获得可执行权限<code>chmod a+x ./myScript.shd</code>, 直接执行 <code>./myScript.sh</code>.</li>
</ol>
</li>
<li>shell的初始化: 用户主目录中的脚本文件~/.bashrc（对于登录shell则是~/.bash_profile).</li>
<li><code>;</code> 用于分割单行的两个命令.</li>
<li><code>echo</code> 引号避免特殊字符被解释,变量替换不发生在单引号中.</li>
<li><code>printf</code> 格式替换 如<code>%-5s</code> 结尾需补充<code>\n</code>.</li>
</ul>
<h2><span id="ming-ling-jie-xi">命令解析</span></h2><p><img src="http://p82ypwviy.bkt.clouddn.com/18-5-2/33010590.jpg" alt="command_process"></p>
<ul>
<li><code>~ + user</code>表示user的bin目录.</li>
<li>双引号 只经过参数扩展、命令代换和算术代换就可以送入执行步骤，而单引号转义符直接会被送入执行步骤<h2><span id="shi-yong-bian-liang-yu-huan-jing-bian-liang">使用变量与环境变量</span></h2></li>
<li>环境变量是shell用于保存需用到的配置信息如可用的打印机,搜索路径等.</li>
<li>命名<ul>
<li>linux文件/文件夹命名: <code>-</code>.</li>
<li>系统文件/变量命名<code>_</code>.</li>
</ul>
</li>
<li><code>env</code>,<code>printenv</code> 查看当前shell的环境变量.</li>
<li><code>pgrep</code>[pattern]: 获取程序的pid; <code>pkill</code>[pattern]: kill程序.</li>
<li><code>ps aux | grep atom</code>  查看所有进程.</li>
<li><code>cat /proc/pid/environ</code> 查看程序的环境变量.</li>
<li><code>=</code>两边没有空格,表示赋值; <code>=</code>有空格,表示等量关系测试.</li>
<li><code>{}</code> 用于包含特殊字符的环境变量</li>
<li><code>export</code>导出环境变量,使得当前shell的子进程继承环境变量.<br>  或者函数  <code>export PATH=&quot;$PATH:/home/user/bin&quot;</code></li>
<li>常用环境变量 <code>HOME</code>、<code>PWD</code>、<code>USER</code>、<code>UID</code>、<code>SHELL</code>:识别当前shell种类</li>
<li>特殊shell 变量符号<ul>
<li><code>#</code>:获得长度.</li>
</ul>
</li>
<li><code>[]</code> 表示test命令 必须要空格隔开.</li>
</ul>
<h2><span id="shi-yong-han-shu-tian-jia-huan-jing-bian-liang">使用函数添加环境变量</span></h2><ul>
<li><code>${parameter:+expression}</code> 如果parameter有值且不为空, 则使用expression的值。</li>
<li><code>prepend() { [ -d &quot;$2&quot; ] &amp;&amp; eval $1=\&quot;$2\$\{$1:+&#39;:&#39;\$$1\}\&quot; &amp;&amp; export $1; }</code></li>
<li><code>eval</code>可读取一连串的参数，然后再依参数本身的特性来执行.</li>
</ul>
<h2><span id="shell-jin-xing-shu-xue-yun-suan">shell进行数学运算</span></h2><ul>
<li><code>let</code> 变量名前不需要用<code>$</code>,如<code>let result=no1+no2; echo $result</code></li>
<li><code>(())</code> 如<code>result=$(( no1 + 50 ))</code> 或 <code>result=$ (( $no1 + 50 ))</code></li>
<li><code>[] = let</code></li>
<li><code>bc</code>命令（支持浮点数）<ul>
<li><code>echo &quot;scale=2;3/8&quot; | bc</code> 设置小数位数为2;</li>
<li><code>echo &quot;obase=2;$no&quot; | bc</code>将数字转化为2进制;</li>
<li><code>echo &quot;obase=10;ibase=2;$no&quot; | bc</code>将二进制转化为十进制</li>
</ul>
</li>
</ul>
<h2><span id="chong-ding-xiang">重定向</span></h2><ul>
<li>重定向相当于输出流入文件; 管道相当于广义上的重定向, 输出流入其他程序</li>
<li><code>&gt;</code>:add, <code>&gt;&gt;</code>:append; <code>&lt;</code>: 从文件像<code>stdin</code>那样读取程序</li>
<li><code>cmd 2&gt;stderr.txt 1&gt;stdout.txt</code></li>
<li><code>cmd 2&gt;&amp;1 all-out-put.txt</code></li>
<li><code>cat a* | tee out.txt | cat -n</code> <code>tee</code> 命令,分叉 -a append</li>
</ul>
<h2><span id="shu-zu-yu-guan-lian-shu-zu">数组与关联数组</span></h2><ul>
<li>定义:<ul>
<li>数组: <code>array_var=(test1 test2 test3 test4)</code></li>
<li>关联数组: 1. <code>declare -A ass_array</code>; 2. <code>ass_array=([index1]=val1 [index2]=val2)</code></li>
</ul>
</li>
<li><code>@</code>,<code>*</code> 获得所有值</li>
<li><code>${!ass_array[@]}</code> 获得所有索引</li>
</ul>
<h2><span id="bie-ming">别名</span></h2><ul>
<li><code>$ echo &#39;alias cmd=&quot;command seq&quot;&#39; &gt;&gt; ~/.bashrc</code></li>
<li>使用原始名<code>\commend</code></li>
</ul>
<h2><span id="cai-ji-zhong-duan-xin-xi">采集终端信息</span></h2><ul>
<li><code>tput</code><ul>
<li>ed: 清空到行尾;</li>
<li>sc: 保存当前位置;</li>
<li>rc: 恢复sc的位置;</li>
</ul>
</li>
<li><code>stty</code> 不显示终端输入.</li>
</ul>
<h2><span id="huo-qu-bing-she-zhi-ri-qi-ji-yan-shi">获取并设置日期及延时</span></h2><ul>
<li><code>date +%s</code>: 获得纪元时<pre><code class="bash">echo Count:
tput sc # loop 40s
for count in `seq 0 40`
do
  tput rc
  tput ed
  echo -n $count
  sleep 1
done
</code></pre>
</li>
</ul>
<h2><span id="diao-shi-jiao-ben">调试脚本</span></h2><ul>
<li><code>bash -x script.sh</code>: 打印运行完的每一行</li>
<li><code>{start..end}</code>: 生成数列</li>
<li><code>set</code> 用于关注部分代码<ul>
<li><code>-x</code> 执行显示参数和命令</li>
<li><code>+x</code> 禁止调试</li>
</ul>
</li>
</ul>
<h2><span id="han-shu-he-can-shu">函数和参数</span></h2><ul>
<li>函数定义： <code>fname() { statement; }</code></li>
<li>函数传递参数： <code>fname arg1 arg2</code> ;</li>
<li>函数参数引用：<ol>
<li>按位置： <code>$1, $2</code>;</li>
<li>整体访问<code>$@</code>, <code>&quot;$\*&quot;=$1c$2c...</code> 扩展成字符串。</li>
</ol>
</li>
</ul>
<h2><span id="di-gui-zha-dan">递归炸弹</span></h2><pre><code>:() {
    : | : &amp; ##管道将输出结果作为另一个输入，子进程呈几何数增加， &amp; 表示后台运行
}; :
</code></pre><p><code>:</code> 是内置的命令，优先级高于函数。</p>
<ul>
<li>’sh‘直接执行一个脚本文件是在一个子shell中运行的，而source则是在当前shell环境中运行的。</li>
<li><code>export</code> 将变量，函数导入子进程中</li>
</ul>
<h2><span id="bao-cun-tui-chu-zhuang-tai">保存退出状态</span></h2><p>成功退出为0</p>
<pre><code class="bash">eval $@
if [ $? -eq 0 ];
then
    echo &quot;$CMD executed successfully&quot;
else
    echo &quot;$CMD terminated unsuccessfully&quot;
fi
</code></pre>
<h2><span id="ming-ling-de-xuan-xiang">命令的选项</span></h2><ul>
<li>options<ul>
<li>短选项，可以组合。</li>
<li>bsd 风格，<code>ps aux</code></li>
<li>长选项 <code>--help</code>(有时带参数<code>--size=1G</code>)</li>
</ul>
</li>
<li>argument<ul>
<li>命令的作用对象.</li>
</ul>
</li>
<li>子shell<ul>
<li>使用变量储存命令，如<code>cmd_output=$(ls | cat -n); echo $cmd_output</code>.</li>
<li>使用`反引号`存储命令输出cmd_output=`COMMANDS`.</li>
</ul>
</li>
</ul>
<h2><span id="zai-bu-an-xia-hui-che-jian-de-qing-kuang-xia-du-ru-n-ge-zi-fu">在不按下回车键的情况下读入n个字符</span></h2><ul>
<li><code>read -n variable_name</code>: 读入固定字符.</li>
<li><code>read -s</code>： 无回显读密码.</li>
<li><code>read -d delim_char var</code>: 以特定分隔符改动var.</li>
</ul>
<h2><span id="chi-xu-yun-xing-ming-ling-zhi-zhi-zhi-xing-cheng-gong">持续运行命令直至执行成功</span></h2><pre><code class="bash">repeat(){
    while true;
    do
        $@ &amp;&amp; return;
        ## sleep 30
    done
}
</code></pre>
<p><code>true</code> 改为 <code>：</code> 避免生成子进程</p>
<h2><span id="zi-duan-fen-ge-fu-yu-die-dai-qi">字段分隔符与迭代器</span></h2><p>IFS被设置为逗号时，shell将逗号视为一个定界符。<br>list 生成<code>{a...z}</code></p>
<h2><span id="loops">loops</span></h2><h3><span id="mian-xiang-lie-biao-de-for-xun-huan">面向列表的for循环</span></h3><pre><code class="bash">for var in list;
do
    commends;
done
</code></pre>
<h3><span id="die-dai-fan-wei-shu-zi">迭代范围数字</span></h3><pre><code class="bash">for(( i=0;i&lt;10;i++ ))
{
    commends;
}
</code></pre>
<h3><span id="while-loop">while loop</span></h3><pre><code class="bash">while condition
do
    commends
done
</code></pre>
<h3><span id="until">until</span></h3><pre><code class="bash">x=0;
until [$x -eq 9 ];
do
    let x++;
    echo $x;
done
</code></pre>
<h3><span id="compare">compare</span></h3><pre><code class="bash">if condition;
then
    commends;
else if condition; then
    commends;
else
    commends;
fi
</code></pre>
<h3><span id="jian-hua-ban-if-else">简化版if、else.</span></h3><p>对条件使用<code>[]</code>, 相当于<code>test</code>命令.</p>
<pre><code class="bash">[ condition ] &amp;&amp; action; ##if condition = true；action
[ condition ] || action; ##if condition = false; action
</code></pre>
<h3><span id="duo-ge-pan-duan-tiao-jian">多个判断条件</span></h3><pre><code class="bash">[ $var1 -ne 0 -a $var2 -gt 2 ] ##逻辑与
[ $var2 -ne 0 -o $var2 -gt 2 ]：##逻辑或
</code></pre>
<h3><span id="zi-fu-chuan-bi-jiao">字符串比较</span></h3><p><code>[[ $str1 &gt; $str2 ]]</code>：如果str1的字母序比str2大，则返回真.<br><code>[[ $str1 &lt; $str2 ]]</code>：如果str1的字母序比str2小，则返回真.</p>
<h3><span id="ce-shi-kong-chuan">测试空串</span></h3><p><code>[[ -z $str1 ]]</code> 空;<br><code>[[ -n $str1 ]]</code> 非空.</p>
<h2><span id="jiao-hu-shell-fei-jiao-hu-shell-deng-lu-shell-fei-deng-lu-shell">交互shell，非交互shell，登陆shell，非登陆shell</span></h2><ol>
<li>区别是否交互来自于是否能够立即执行输入的指令。读取的配置文件不同，交互式bash必然读取<code>~/.bashrc</code>文件；非交互式bash读取的是环境变量BASH_ENV（通常情况下）所指定的配置文件。</li>
<li>区别是否登陆来自于启动shell是否需要login。启动shell时所执行的startup文件不同。登陆shell执行startup文件：<code>/etc/profile</code>,<code>$HOME/.profile</code>,<code>$HOME/.bash_login</code>,<code>$HOME/.bash_profile</code>，而非登陆shell执行的startup文件仅为：~/.bashrc。如ssh命令读取文件<code>/etc/bash.bashrc $HOME/.bashrc</code>。但是ssh登陆会话会额外读取<code>/etc/profile</code></li>
<li>如果.bash_login或.bash_profile存在，则不会读取.profile。不过其他shell可能会读取该文件。</li>
<li>导出变量和函数会传递到子shell中，但是别名不会。你必须将BASH_ENV的值设置为.bashrc或.profile，然后在其中定义别名，这样就可以在shell脚本中使用这些别名了。</li>
</ol>

  </section>

</article>



            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2018 - This site is created by <a href="/">@Zexing Jiang</a>.
    </span>
    <span class="footer__copyright">
        The Contents on this site is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">a Creative Commons Attribution 4.0 International license</a>.
    </span>
    <span class="footer__copyright">
        The layout is powered by <a href="http://hexo.io">Hexo</a>， running on <a href="https://pages.github.com/">GitHub Pages</a>.
    </span>
    <span class="footer__copyright">
        The theme is <a href="https://github.com/lenbo-ma/hexo-theme-vno">hexo-theme-vno</a>, modified from <a href="http://github.com/onevcat/vno" target="_blank">Vno</a>.
    </span>
</footer>

        </div>
    </div>

    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <!-- highlight.js代码高亮主题 script 引入-->
    <script src="/plugins/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad(); console.log("Highlight has loaded") </script>
    <!-- highlight.js代码高亮主题 script 引入-->
     
</body>
</html>
